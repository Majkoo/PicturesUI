<div class="row">

  <div class="col-12 text-left mb-2">
    <h2><strong>{{picture.name | titlecase}}</strong></h2>
  </div>

  <div class="col-12 col-md-8 text-center d-flex flex-column align-items-center justify-content-center">
    <app-modal-pic
      [url]="picture.url"
      [name]="picture.name"
      [accountNickname]="picture.accountNickname"
      [tags]="picture.tags">
    </app-modal-pic>
  </div>

  <div class="col-12 col-md-4 d-flex flex-column justify-content-start pt-3 pt-md-0">
      <app-modal-info
        [pictureAdded]="picture.pictureAdded"
        [description]="picture.description"
        [accountNickname]="picture.accountNickname">
      </app-modal-info>
    <div class="h-100 d-flex flex-column justify-content-between">
      <div>
        <p class="text-muted text-center mb-2">Jako właściciel obrazka, możesz go edytować lub usunąć.</p>
        <div class="d-flex justify-content-center mb-3">
          <p-selectButton [options]="selectOptions" [(ngModel)]="selectValue" optionLabel="name">
            <ng-template let-item>
              <p class="select-item">{{item.name}}</p>
            </ng-template>
          </p-selectButton>
        </div>
        <div class="d-flex justify-content-center mb-2" *ngIf="selectValue.name === 'Edytuj'">
          <p-selectButton [options]="editOptions" [(ngModel)]="editValue" optionLabel="name">
            <ng-template let-item>
              <p class="select-item">{{item.name}}</p>
            </ng-template>
          </p-selectButton>
        </div>
      </div>

      <form [formGroup]="changeTags" (ngSubmit)="submitTags()"
            *ngIf="editValue.name === 'Tagi' && selectValue.name === 'Edytuj'">
        <h3 class="mt-3 mb-4">Zmień tagi obrazka</h3>
        <div class="mb-4 w-100 text-left">
          <div class="p-float-label w-100">
            <p-chips #pChips
                     id="chips"
                     formControlName="tags"
                     [allowDuplicate]="false"
                     [addOnTab]="true"
                     (onAdd)="trimChips()" (keydown)="onKeyDown($event)" (touchend)="onKeyDown($event)" [addOnBlur]="true">
              <ng-template let-item pTemplate="item">
                <span class="bi bi-tag">{{item}}</span>
              </ng-template>
            </p-chips>
            <label for="chips">Tagi</label>
          </div>
          <p class="lh15 mt-1"><small id="chips-help" class="mx-1 text-muted">Możesz wprowadzić maksymalnie 6 tagów.</small></p>
        </div>
        <div class="d-flex justify-content-center mb-5">
          <button pButton pRipple type="submit" label="Zatwierdź zmiany"
                  class="p-button-primary px-5 py-2" [disabled]="changeTags.invalid || awaitSubmit"></button>
        </div>
      </form>
      <form [formGroup]="changeName" (ngSubmit)="submitName()"
            *ngIf="editValue.name === 'Nazwa' && selectValue.name === 'Edytuj'">
        <h3 class="mt-3 mb-4">Zmień nazwę obrazka</h3>
          <div class="text-left w-100 mb-4">
              <span class="p-float-label">
                <input id="name-input" class="w-100" type="text"
                       [ngClass]="changeName.get('name')!.touched ? 'ng-dirty' : ''"
                       formControlName="name" pInputText>
                <label for="name-input">Nazwa obrazka</label>
              </span>
            <span *ngIf="changeName.get('name')!.touched && changeName.get('name')!.invalid">
                <small id="name-input-error-required" class="px-1 p-error block"
                     *ngIf="changeName.get('name')!.errors!['required']">
                  Nazwa obrazka jest wymagana
                </small>
                <small id="name-input-error-minlength" class="px-1 p-error block"
                       *ngIf="changeName.get('name')!.errors!['minlength']">
                  Nazwa obrazka powinna zawierać co najmniej 4 znaki
                </small>
                <small id="name-input-error-maxlength" class="px-1 p-error block"
                       *ngIf="changeName.get('name')!.errors!['maxlength']">
                  Nazwa obrazka powinna zawierać maksymalnie 40 znaków
                </small>
              </span>
          </div>
        <div class="d-flex justify-content-center mb-5">
          <button pButton pRipple type="submit" label="Zatwierdź zmiany"
                  class="p-button-primary px-5 py-2" [disabled]="changeName.invalid || awaitSubmit"></button>
        </div>
      </form>
      <form [formGroup]="changeDesc" (ngSubmit)="submitDesc()"
            *ngIf="editValue.name === 'Opis' && selectValue.name === 'Edytuj'">
        <h3 class="mt-3 mb-4">Zmień opis obrazka</h3>
        <div class="w-100 mb-3">
          <span class="p-float-label">
          <textarea id="pic-desc-input" class="w-100" formControlName="desc" pInputTextarea></textarea>
          <label for="pic-desc-input">Opis obrazka</label>
        </span>
          <span *ngIf="changeDesc.get('desc')!.touched && changeDesc.get('desc')!.invalid">
            <small id="desc-input-error-maxlength" class="px-1 p-error block"
                 *ngIf="changeDesc.get('desc')!.errors!['maxlength']">
              Opis obrazka powinien zawierać maksymalnie 500 znaków
            </small>
          </span>
        </div>
        <div class="d-flex justify-content-center mb-5">
          <button pButton pRipple type="submit" label="Zatwierdź zmiany"
                  class="p-button-primary px-5 py-2" [disabled]="changeDesc.invalid || awaitSubmit"></button>
        </div>
      </form>

      <div class="w-100 mb-5" *ngIf="selectValue.name === 'Usuń'">
        <div class="mb-3 text-center text-muted">
          <p>Pamiętaj, że usunięcie obrazka jest nieodwracalne!</p>
        </div>
        <input type="text" pInputText class="w-100 mb-2" placeholder="Wpisz nazwę obrazka, aby usunąć" [(ngModel)]="deletePhrase">
        <button pButton pRipple class="p-button-danger w-100" label="Usuń ten obrazek" (click)="delete()"
                [disabled]="deletePhrase.toLowerCase() !== picture.name.toLowerCase()">
        </button>
      </div>

    </div>

  </div>

</div>
